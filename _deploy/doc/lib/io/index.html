<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>IO</title>
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://melt.cs.umn.edu/lib/io/">
    
    <script src="/js/nav.js"></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Silver Documentation</a>

  </div>

</header>


    <div class="site-nav">
      

<ul class="nav">

    
    <li>
    
        <a href="doc/">Home</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/install-guide/">Installation guide</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/command-line-reference/">Command line reference</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/faq/">Frequently asked questions (FAQ)</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/error-faq/">Frequently found errors (FFE)</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Tutorials (TODO)
    
    
        

<ul class="nav">

    
    <li>
    
        Intro to AGs - dc?
    
    
    </li>

    
    <li>
    
        Simple
    
    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Concepts
    
    
        

<ul class="nav">

    
    <li>
    
        Attribute grammars
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/decorated-vs-undecorated/">Decorated vs undecorated</a>
    
    
    </li>

    
    <li>
    
        Forwarding
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/aspects/">Aspects</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/collections/">Collection attributes</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/modules/">The module system</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/types/">Types</a>
    
    
    </li>

    
    <li>
    
        Concrete syntax
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/io/">IO</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/lr-parsing/">LR parsing</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/ffi/">Foreign Function Interface</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/modular-well-definedness/">Modular well-definedness</a>
    
    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Language reference
    
    
        

<ul class="nav">

    
    <li class="collapsible collapsed">
    
        Declarations
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/decl/nonterminals/">Nonterminals</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        <a href="doc/ref/decl/productions/">Productions</a>
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/decl/productions/concrete/">Concrete</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/productions/aspect/">Aspect</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/productions/default/">Default</a>
    
    
    </li>

</ul>

    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/attributes/">Attributes</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/occurs/">Occurs</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/functions/">Functions</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/globals/">Global values</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/types/">Type declarations</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/parsers/">Parser declarations</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/terminals/">Terminals</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/annotations/">Annotations</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Copper-specific
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/decl/copper/parser-attribute/">Parser attributes</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/copper/lexer-class/">Lexer classes</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/copper/disambiguate/">Disambiguation functions</a>
    
    
    </li>

</ul>

    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Production body
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/stmt/equations/">Equations</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/stmt/forwarding/">Forwards to</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/stmt/locals/">Locals</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/stmt/return/">Return</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Copper-specific
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/stmt/copper/pluck/">Pluck</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/stmt/copper/print/">Print</a>
    
    
    </li>

</ul>

    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Expressions
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/expr/calls/">Function/production application</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/attribute-access/">Attribute access</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/booleans/">Boolean expressions</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/comparisons/">Comparison operators</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/numeric/">Numeric expressions</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/decorate/">Decorate with</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/new/">New (undecorate)</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/terminal/">Terminal literals</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/pattern-matching/">Pattern matching</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/let/">Lets</a>
    
    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Extensions
    
    
        

<ul class="nav">

    
    <li>
    
        List syntax
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/ext/easy-terminal/">Easy terminals</a>
    
    
    </li>

    
    <li>
    
        Convenience
    
    
    </li>

</ul>

    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Library reference
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/lib/string/">String</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/pair/">Pair</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/list/">List</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/maybe/">Maybe</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/io/">IO</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/document-pp/">Document (pp)</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/other/">Other</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/comparison/">Comparison fns</a>
    
    
    </li>

</ul>

    
    </li>

    
    <li>
    
        <a href="doc/bibliography/">Bibliography</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/style-guide/">Style guide</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Development
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/dev/building/">Building Silver</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/code-organization/">Code organization</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/runtime-editing/">Runtime development</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/long-term-todo/">Silver popularity todo list</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Eclipse
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/dev/eclipse/getting-started/">Getting started</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/eclipse/ide-decl/">Creating an IDE plugin</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/eclipse/internals/">Eclipse internals docs</a>
    
    
    </li>

</ul>

    
    </li>

</ul>

    
    </li>

</ul>

    </div>

    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">IO</h1>
  </header>

  <article class="post-content">
    <h1 id="input-and-output">Input and Output</h1>

<p>There are no real values of type <em><code>IO</code></em>, instead, this is a “token” value<br />
that is passed around in order to preserve the order of execution of<br />
imperative IO actions.  You can think of <em><code>IO</code></em> values as being the entire<br />
universe, and the <em><code>IO</code></em> input to a function is the state before the action<br />
and the <em><code>IO</code></em> output of a function is the state after the action.</p>

<blockquote>
  <p><em><strong>Note:</strong></em> As of version 0.3.1, there is no support for monads in Silver, yet. Monads are a convenient way of hiding the <em><code>IO</code></em> token itself, ensuring the programmer does not make mistakes with the way it is passed around.</p>
</blockquote>

<p>Since many IO functions will want to return more than the resulting <em><code>IO</code></em><br />
token, there is a standard type called <em><code>IOVal&lt;a&gt;</code></em> that IO functions use<br />
to return values of other types in addition.</p>

<p><em><code>IOVal</code></em> has only one constructor, <em><code>ioval</code></em>.</p>

<pre><code>abstract production ioval
top::IOVal&lt;a&gt; ::= i::IO v::a
</code></pre>

<p>The first parameter is the IO token, and the second is the value to wrap up.</p>

<blockquote>
  <p><em><strong>Note:</strong></em> There is an unofficial convention for Silver standard library functions to place the “primary” value last.  <em><code>ioval</code></em> arguably violates this convention, for legacy reasons.</p>
</blockquote>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
function main
IOVal&lt;Integer&gt; ::= args::[String] ioin::IO
{
  return ioval(print("Hi\n", ioin), 0);
}
</code><br />
is a Silver program that prints <em><code>"Hi"</code></em>, and exits with a successful error code.</p>
</blockquote>

<h2 id="important-io-functions">Important IO functions</h2>

<h3 id="print">print</h3>
<pre><code>function print
IO ::= s::String i::IO
</code></pre>

<p>Displays a string on standard out. Newlines are NOT automatically added.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
print("world!\n", print("Hello, ", ioin))
</code><br />
will print <em><code>"Hello, world!"</code></em>.</p>
</blockquote>

<h3 id="readfile">readFile</h3>
<pre><code>function readFile
IOVal&lt;String&gt; ::= s::String i::IO
</code></pre>

<p>Read the entire contents of a file.  All instances of “\r\n” are replaced by “\n”<br />
to work around issues on windows.  If the read fails, an uncatchable error<br />
is thrown.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
local attribute contents :: IOVal&lt;String&gt;;
contents = readFile(head(args), ioin);
</code><br />
will store the contents of the first argument into <em><code>contents</code></em>.</p>
</blockquote>

<h3 id="writefile">writeFile</h3>
<pre><code>function writeFile
IO ::= file::String contents::String i::IO
</code></pre>
<p>Write a string to a file, replacing whatever is there already. If the write fails, an uncatchable error is thrown.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
writeFile("output.txt", tree.pp, ioin)
</code><br />
will write <em><code>tree</code></em>’s pretty print to <em><code>"output.txt"</code></em>.</p>
</blockquote>

<h3 id="readlinestdin">readLineStdin</h3>
<pre><code>function readFile
IOVal&lt;String&gt; ::= i::IO
</code></pre>

<p>Reads a line from standard input.  If the read fails, an uncatchable error is thrown.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
local attribute text :: IOVal&lt;String&gt;;
contents = readLineStdIn(ioin);
</code><br />
will store one line from stdin into <em><code>text</code></em>.</p>
</blockquote>

<h2 id="other-io-functions">Other IO functions</h2>

<h3 id="exit">exit</h3>
<pre><code>function exit
IO ::= val::Integer i::IO
</code></pre>

<p>Terminates immediately with the specified error code.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
print("Hi", exit(-1, ioin))
</code><br />
will terminate with an error before ever printing the string.</p>
</blockquote>

<h3 id="mkdir">mkdir</h3>
<pre><code>function mkdir
IOVal&lt;Boolean&gt; ::= s::String i::IO
</code></pre>

<p>Creates a directory, including any parents that need to be created along the way.<br />
Similar to ‘mkdir -p’. If it fails, it may create only some of them.</p>

<p>Returns true if successful, otherwise returns false.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
mkdir("a/sub/directory", ioin)
</code><br />
will create <em><code>./a/sub/directory/</code></em>.</p>
</blockquote>

<h3 id="system">system</h3>
<pre><code>function system
IOVal&lt;Integer&gt; ::= s::String i::IO
</code></pre>

<p>Executes a shell command.  Specifically executes <em><code>bash -c</code></em>. (And thus, may not<br />
work on windows, unless executing under cygwin or similar.)</p>

<p>Avoid using this if possible.  If you need to perform some ordinary form of IO Silver does not yet support, please request it on the \texttt{melt-help@cs.umn.edu} mailing list.</p>

<p>Access to command’s output is not directly available, but it is run in a shell. You can redirect to a file and read that.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
system("silver some:grammar &amp;&amp; ant &gt; stdout.txt 2&gt; stderr.txt", ioin)
</code><br />
will run the commands, and leave their output in some files.</p>
</blockquote>

<h3 id="appendfile">appendFile</h3>
<pre><code>function appendFile
IO ::= file::String contents::String i::IO
</code></pre>

<p>Unlike <a href="Reference_IO#writeFile.md">writeFile</a>, appends<br />
the string to the end of the file instead of truncating the file first.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
appendFile("log.txt", "Oh, my.\n", ioin)
</code><br />
add <em><code>"Oh, my."</code></em> to the end of <em><code>log.txt</code></em>.</p>
</blockquote>

<h3 id="filetime">fileTime</h3>
<pre><code>function fileTime
IOVal&lt;Integer&gt; ::= s::String i::IO
</code></pre>

<p>The time, in seconds since 1970, when this file (or directory) was last modified.<br />
0 if the file is not found.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
fileTime("log.txt", ioin)
</code><br />
returns the time the file was last modified (wrapped.)</p>
</blockquote>

<h3 id="isfile">isFile</h3>
<pre><code>function isFile
IOVal&lt;Boolean&gt; ::= s::String i::IO
</code></pre>

<p>Checks if a file is an ordinary file.  (non-directory, non-special)</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
isFile("/etc/passwd", ioin)
</code><br />
returns is true (wrapped). On linux, anyway.</p>
</blockquote>

<h3 id="isdirectory">isDirectory</h3>
<pre><code>function isDirectory
IOVal&lt;Boolean&gt; ::= s::String i::IO
</code></pre>

<p>Checks if a path is a directory.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
isDirectory("/etc/passwd", ioin)
</code><br />
returns is false (wrapped.)</p>
</blockquote>

<h3 id="cwd">cwd</h3>
<pre><code>function cwd
IOVal&lt;String&gt; ::= i::IO
</code></pre>

<p>Return the current working directory. (There is no way to change it.)</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
cwd(ioin)
</code><br />
returns the directory the program was run from (wrapped.)</p>
</blockquote>

<h3 id="envvar">envVar</h3>
<pre><code>function envVar
IOVal&lt;String&gt; ::= s::String i::IO
</code></pre>

<p>Obtains the value of an environment variable. (There is no way to set them.)</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
envVar("GRAMMAR_PATH", ioin)
</code><br />
returns the value of the grammar path environment variable (wrapped.)</p>
</blockquote>

<h3 id="listcontents">listContents</h3>
<pre><code>function listContents
IOVal&lt;[String]&gt; ::= s::String i::IO
</code></pre>

<p>List the contents of a directory. Returns the empty list if not a directory or<br />
other IO error.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
listContents(".", ioin)
</code><br />
returns a list of the files (or directories) in the current directory (wrapped.)</p>
</blockquote>

<h3 id="deletefile">deleteFile</h3>
<pre><code>function deleteFile
IOVal&lt;Boolean&gt; ::= s::String i::IO
</code></pre>

<p>Delete a file, or an empty directory. Returns false if an error occurs, or the<br />
file does not exist (or the directory is non-empty.)</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
deleteFile("doesNotExist.txt", ioin)
</code><br />
will return false (wrapped), or delete that file.</p>
</blockquote>

<h2 id="circumventing-the-io-token">Circumventing the IO token</h2>

<p>Sometimes, it is necessary to take some action in a place where IO is not available. This occurs most often when some internal error occurs, or when attempting to debug an attribute grammar specification.</p>

<h3 id="error">error</h3>
<pre><code>function error
a ::= msg::String
</code></pre>

<p>Die with the stated error message and a stack trace when evaluated. Note that Silver stacks may be hard to read (it’s a lazy language.)</p>

<p>Note that <em><code>IO</code></em> is not involved at all.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
error("Not yet implemented!")
</code><br />
terminates with the error message.</p>
</blockquote>

<h3 id="genint">genInt</h3>
<pre><code>function genInt
Integer ::= 
</code></pre>

<p>Generate an integer unique to this run of this process.  (Starts from 0 and just counts up each call.)  This violates the “purity” of Silver code, but it’s incredibly convenient! :)</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
abstract production foo
top::Expr ::=
{
  production attribute myid::String;
  myid = "foo#" ++ toString(genInt());
}
</code><br />
assigns a unique (to this run of the process) id for each instance of the production <em><code>foo</code></em>.</p>
</blockquote>

<h3 id="unsafetrace--unsafeio">unsafeTrace / unsafeIO</h3>
<pre><code>function unsafeTrace
a ::= val::a act::IO

function unsafeIO
IO ::= 
</code></pre>

<p>When an expression is evaluated by the runtime system, executes the actions associated with the IO token <em><code>act</code></em> (a sequence that should be started by calling <em><code>unsafeIO()</code></em>), and then simply returns the value <em><code>val</code></em>.</p>

<blockquote>
  <p><em><strong>Example:</strong></em><br />
<code>
unsafeTrace(foo.pp, print("foo's pp is " ++ foo.pp, unsafeIO()))
</code><br />
prints out <em><code>foo</code></em>’s pretty print, before returning it.</p>
</blockquote>

<blockquote>
  <p><em><strong>Example:</strong></em> This usage is STRONGLY DISCOURAGED, but may sometimes be necessary during debugging or testing.<br />
<code>
readFile("something.txt", unsafeIO()).iovalue
</code><br />
evaluates to the contents of a file, without having any IO tokens around.</p>
</blockquote>

<h1 id="todo">TODO</h1>

<p>Some of this page should be in a Concept_IO, and the rest is probably just library documentation, but move it here for now.</p>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

  </div>

</footer>

<script>nav_hook();</script>


  </body>

</html>
