<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Modular well-definedness</title>
    <meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://melt.cs.umn.edu/concepts/modular-well-definedness/">
    
    <script src="/js/nav.js"></script>
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Silver Documentation</a>

  </div>

</header>


    <div class="site-nav">
      

<ul class="nav">

    
    <li>
    
        <a href="doc/">Home</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/install-guide/">Installation guide</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/command-line-reference/">Command line reference</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/faq/">Frequently asked questions (FAQ)</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/error-faq/">Frequently found errors (FFE)</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Tutorials (TODO)
    
    
        

<ul class="nav">

    
    <li>
    
        Intro to AGs - dc?
    
    
    </li>

    
    <li>
    
        Simple
    
    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Concepts
    
    
        

<ul class="nav">

    
    <li>
    
        Attribute grammars
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/decorated-vs-undecorated/">Decorated vs undecorated</a>
    
    
    </li>

    
    <li>
    
        Forwarding
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/aspects/">Aspects</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/collections/">Collection attributes</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/modules/">The module system</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/types/">Types</a>
    
    
    </li>

    
    <li>
    
        Concrete syntax
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/io/">IO</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/lr-parsing/">LR parsing</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/ffi/">Foreign Function Interface</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/concepts/modular-well-definedness/">Modular well-definedness</a>
    
    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Language reference
    
    
        

<ul class="nav">

    
    <li class="collapsible collapsed">
    
        Declarations
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/decl/nonterminals/">Nonterminals</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        <a href="doc/ref/decl/productions/">Productions</a>
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/decl/productions/concrete/">Concrete</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/productions/aspect/">Aspect</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/productions/default/">Default</a>
    
    
    </li>

</ul>

    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/attributes/">Attributes</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/occurs/">Occurs</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/functions/">Functions</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/globals/">Global values</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/types/">Type declarations</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/parsers/">Parser declarations</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/terminals/">Terminals</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/annotations/">Annotations</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Copper-specific
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/decl/copper/parser-attribute/">Parser attributes</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/copper/lexer-class/">Lexer classes</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/decl/copper/disambiguate/">Disambiguation functions</a>
    
    
    </li>

</ul>

    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Production body
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/stmt/equations/">Equations</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/stmt/forwarding/">Forwards to</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/stmt/locals/">Locals</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/stmt/return/">Return</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Copper-specific
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/stmt/copper/pluck/">Pluck</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/stmt/copper/print/">Print</a>
    
    
    </li>

</ul>

    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Expressions
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/ref/expr/calls/">Function/production application</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/attribute-access/">Attribute access</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/booleans/">Boolean expressions</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/comparisons/">Comparison operators</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/numeric/">Numeric expressions</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/decorate/">Decorate with</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/new/">New (undecorate)</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/terminal/">Terminal literals</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/pattern-matching/">Pattern matching</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/expr/let/">Lets</a>
    
    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Extensions
    
    
        

<ul class="nav">

    
    <li>
    
        List syntax
    
    
    </li>

    
    <li>
    
        <a href="doc/ref/ext/easy-terminal/">Easy terminals</a>
    
    
    </li>

    
    <li>
    
        Convenience
    
    
    </li>

</ul>

    
    </li>

</ul>

    
    </li>

    
    <li class="collapsible collapsed">
    
        Library reference
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/lib/string/">String</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/pair/">Pair</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/list/">List</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/maybe/">Maybe</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/io/">IO</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/document-pp/">Document (pp)</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/other/">Other</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/lib/comparison/">Comparison fns</a>
    
    
    </li>

</ul>

    
    </li>

    
    <li>
    
        <a href="doc/bibliography/">Bibliography</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/style-guide/">Style guide</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Development
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/dev/building/">Building Silver</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/code-organization/">Code organization</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/runtime-editing/">Runtime development</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/long-term-todo/">Silver popularity todo list</a>
    
    
    </li>

    
    <li class="collapsible collapsed">
    
        Eclipse
    
    
        

<ul class="nav">

    
    <li>
    
        <a href="doc/dev/eclipse/getting-started/">Getting started</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/eclipse/ide-decl/">Creating an IDE plugin</a>
    
    
    </li>

    
    <li>
    
        <a href="doc/dev/eclipse/internals/">Eclipse internals docs</a>
    
    
    </li>

</ul>

    
    </li>

</ul>

    
    </li>

</ul>

    </div>

    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header">
    <h1 class="post-title">Modular well-definedness</h1>
  </header>

  <article class="post-content">
    <h2 id="running-the-analysis">Running the analysis</h2>

<p>Run silver using the <code>--clean</code> and <code>--warn-all</code> flags.</p>

<pre><code>silver --clean --warn-all my:project:grammar
</code></pre>

<p>Note that <code>--clean</code> is not, strictly speaking, necessary, but the build system does not currently dirty enough grammars by default, and you may unexpectedly miss warnings from grammars it decides do not need to be re-analyzed.</p>

<p>Running the analysis will approximately double the Silver part of compile times… so perhaps a 40% increase over all.  This will be fixed eventually.  It’s just naively implemented at the moment.</p>

<h3 id="getting-old-code-to-satisfy-the-analysis">Getting old code to satisfy the analysis</h3>

<p>If you’re overwhelmed by warnings, you can fix them in the following order to keep things more sensible:</p>

<pre><code>--warn-orphaned --warn-fwd
--warn-eqdef
--warn-missing-syn
--warn-missing-inh
</code></pre>

<p>That is, fix the first, then add the next line to your compiler flags, etc.  (We may actually build this ordering into the analysis eventually…)  Always include <code>--clean</code>, of course.</p>

<p>The first line of warnings should be independent of each other. The next two flags enable warnings that could appear / disappear as earlier types of problems are discovered.  The last warnings flag is a sort-of global analysis, so it can have oddly non-local effects (or get spammy) if you still have earlier warnings in the code.</p>

<h2 id="understanding-the-analysis-in-three-easy-steps">Understanding the analysis in three easy steps</h2>

<ol>
  <li>A fundamental notion of the analysis is “<strong>exported by</strong>.”  We consider the defining features of a declaration to be those things you always must have in the environment if you have that declaration in the environment.</li>
  <li>The expression problem must be solved: only production <strong>exported by</strong> a nonterminal can be non-forwarding, everything else is considered an extension (and thus, must forward to solve the expression problem, e.g. ensure semantics from extension A are defined on new syntax from independent extension B.)</li>
  <li>Synthesized attributes are “sorta” methods, and inherited attributes are “sorta” just method parameters. AG notation is wonderful in that this is inferred, but the analysis essentially dictates that whatever inherited dependencies that appear in equations that are <strong>exported by</strong> an attribute occurrence defines the set of inherited attributes usable by that attribute.  In essence, errors about “exceeding the flow type” can be read as “this method does not have that parameter.”</li>
</ol>

<h2 id="interpreting-the-warnings">Interpreting the warnings</h2>

<p>In the following explanations we’ll say X “is exported by” Y, if Y appears in a grammar that is exported (or the same) grammar that X appears in.</p>

<h3 id="orphaned-occurs">Orphaned occurs</h3>

<p>Occurs declarations must be exported by EITHER the attribute declaration or the nonterminal declaration.</p>

<p>Most likely, the declaration should be moved to one of those grammars.</p>

<h3 id="orphaned-equation">Orphaned equation</h3>

<p>Equations (that is, <code>lhs.pp = "hi";</code> inside a production block) must be exported by either the occurs declaration (that is, <code>attribute pp occurs on Expr</code>) or by the production declaration (aspects do not count, of course.)</p>

<p>Most likely, the equations should be moved to one of those grammars.</p>

<h3 id="orphaned-production">Orphaned production</h3>

<p>Productions should either by exported by their associated nonterminal declaration, or they should forward.</p>

<p>Most likely, the production should forward, or be moved into the “host language” that is declaring the nonterminal.</p>

<p>Or…</p>

<h4 id="other-options">Other options</h4>

<p>Nonterminals that are purely concrete syntax, and not abstract, that only have, say an <code>ast</code> attribute on them can be declared closed (<code>closed nonterminal Expr_c;</code>) and then the production does not need to forward.  This only really applies to concrete syntax (until you know what you’re doing!) because it prevents any new attributes from occurring on it (which is fine when all you need is <code>ast</code>.)</p>

<p>If the production does NOT have anything it can validly forward to, then either it is NOT a valid extension (according to Silver’s notion of extension) or the host language must be changed somehow.  Optional components of a host language can be permitted by adding an optional export to the host language. (That is, host will add <code>option some:modification;</code>.)</p>

<h3 id="missing-synthesized-equation">Missing synthesized equation</h3>

<p>Productions that do not forward must have equations specifying the value of every attribute that occurs on its associated nonterminal.  Simply add the equation. It’s missing.</p>

<h3 id="missing-inherited-equation">Missing inherited equation</h3>

<p>This is slightly trickier.  Silver will not require that all inherited attributes be supplied, as this is not possible in a modular way.  Instead, it requires inherited equations be present that it suspects are necessary to evaluated (for example) synthesized attributes that are demanded.</p>

<p>Generally, the solution to these warnings is to add an equation for the inherited attribute.  However, in some cases, the real solution may be to determine why Silver believes it needs an inherited attribute that you are certain it does not. This can be somewhat tricky, as the culprit could be anywhere.  There does exist a <code>--dump-flow-deps</code> flag that produces a dot file, however this is typically too large to actually visualize.  It might be useful to grep, however.</p>

<h2 id="tracking-down-flow-problems">Tracking down flow problems</h2>

<p>Flow type errors have an annoying tendency to be non-local.</p>

<p>Invoking silver with the <code>--dump-flow-graph</code> flag can be helpful in trying to determine what’s going on. This generates two files. <code>flow-types.dot</code> has flow type information for nonterminals, and <code>flow-deps-transitive.dot</code> has flow graph information for productions, with <code>flow-deps-direct.dot</code> containing only immediate dependencies (i.e. unsolved graphs.)  This latter might be useful occasionally in trying to track down the “culprits” causing unwanted dependencies.</p>

<p>I recommend trying to grep through these to find the information you want. For example, if you’re just trying to debug the flow type for forward equations, you can use:</p>

<pre><code>egrep "(\{|\}|\"[A-Za-z:_0-9]*/forward\" -&gt;)" flow-deps.dot
</code></pre>

<p>If you want to find all lines that are deps of synthesized equations only, us:</p>

<pre><code>egrep -v ".*/.*/.*-&gt;" flow-deps.dot
</code></pre>

  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

  </div>

</footer>

<script>nav_hook();</script>


  </body>

</html>
